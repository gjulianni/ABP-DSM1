<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Innovatech</title>
  <link rel="stylesheet" href="../css/inicio.css">
  <link rel="stylesheet" href="../css/certificado.css">
  <link rel="icon" href="../src/images/cadastro-img-innova.png">
  <script src="../js/geral.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
  <script src="../backend/servidor/src/controladores/questionario.js"></script>
  <script src="../backend/servidor/src/controladores/questao.js"></script>
  <script src="../backend/servidor/src/controladores/calculo.js"></script>
</head>
<body>
  <div class="main-inicio">
    <div class="top-bar">
      <img class="innova-logo" src="../images/cadastro-img-innova.png" alt="Logo Innovatech">
      <h1>Innovatech</h1>
      <script src="../js/greetings.js"></script>
      <script src="../js/index.js"></script>
    </div>
    <span class="btn-sidebar" style="font-size:50px;cursor:pointer" onclick="openNav()">&#9776;</span>
    <div id="sidebar" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <div class="sidebar-links">
        <a href="../frontend/inicio.html">Home</a>
        <a href="../frontend/cursos.html">Curso</a>
        <a href="../frontend/avaliacao.html">Avaliação</a>
        <a href="#">Certificação</a>
        <a href="../frontend/login.html" onclick="logout()">Sair</a>
      </div>
    </div>
    <script>
      function openNav() {
        document.getElementById("sidebar").style.width = "250px";
      }
      function closeNav() {
        document.getElementById("sidebar").style.width = "0";
      }
    </script>


<script>
  async function verificarAprovacao(idusuario) {
    const response = await fetch('http://localhost:3030/verificar-aprovacao', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ idusuario })
    });

    const data = await response.json();
    console.log('Dados da resposta:', data);

    if (data.aprovado) {
      console.log('Usuário aprovado.');


      const btnObterCertificado = document.querySelector('.certificate-preview .button-enabled');
      btnObterCertificado.style.display = "flex";
      const btnNotaInsuficiente = document.querySelector('.certificate-preview .button-disabled');
      btnNotaInsuficiente.style.display = "none";

      const notaInsuficiente = document.querySelector('.not-enough-score');
      notaInsuficiente.style.display = "none";
      const imgCertificado = document.querySelector('.preview img');
      imgCertificado.style.filter = "none";

      const lastScore = document.getElementById('last-score');
      lastScore.textContent = `${data.nota}`;

     
     
    } 
  }

  document.addEventListener("DOMContentLoaded", async () => {
    const usuarioLogadoJSON = localStorage.getItem('usuario');
    const usuarioLogado = JSON.parse(usuarioLogadoJSON);
    const idusuario = usuarioLogado.idusuario;
    if (idusuario !== null) {
      verificarAprovacao(idusuario);
    }
    else {
      console.log("jdfgbgffdigkdf")
    }
  });
</script>


    <div class="text-obter">
    <h1>Obtenha seu Certificado!</h1>
  </div>
    <section class="certification">
      <div class="evaluation-info">
        <div class="evaluation-details">
          <div class="info-box">
            <p>Nota da sua última avaliação: <span id="last-score">N/A</span></p>
          </div>
          
          <div class="info-box">
            <div class="evaluation-history">
              <h2>Seu histórico de avaliações:</h2>
              <p id="evaluation-message">Você ainda não alcançou a nota mínima para a liberação da certificação!</p>
              <p>Se esforce para alcançar uma nota &gt;70%</p>
            </div>
          </div>
        </div>
        <div class="certificate-preview">
          <div class="preview">
            <img src="../images/certificado.png" alt="Preview do Certificado">
            <div class="not-enough-score">
            <h5>Sua nota ainda não é suficiente para desbloquear o certificado!</h5>
          </div>
          <button class="button-disabled">Nota insuficiente</button>
          <button class="button-enabled">Obter certificado</button>
        </div>
          
        </div>      
      </div>
    </section>
  </div>
</body>
</html>
